
# docker零入门到跑koa2

## install
官方下载，浏览器下载很慢，用迅雷下

正常软件安装 

```
# 验证安装
docker version
docker info

# 列出本机的所有 image 文件。
$ docker image ls

# 创建docker id
docker image pull library/hello-word
Using default tag: latest
Error response from daemon: pull access denied for hello-word, repository does not exist or may require 'docker login'

```

[创建docker 账户id](https://hub.docker.com/?utm_source=docker4mac_2.0.0.3&utm_medium=account_create&utm_campaign=referral)

gjincai
1262868349@qq.com
gjincaikop
```
docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.
Username: gjincai
Password:
Login Succeeded
```

## 配置国内镜像加速
[配置国内镜像加速](https://github.com/yeasy/docker_practice/blob/master/install/mirror.md)

## hello world
需要先登录

```
#docker image pull是抓取 image 文件的命令

docker image pull library/hello-world

#Docker 官方提供的 image 文件，都放在library组里面，所以它的是默认组，可以省略

docker image pull hello-world

#docker container run命令具有自动抓取 image 文件的功能。如果发现本地没有指定的 image 文件，就会从仓库自动抓取。因此，前面的docker image pull命令并不是必需的步骤。

docker container run hello-world

Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete
......

```

```
## 列出本机正在运行的容器:无
docker container ls
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES


## 列出本机所有容器，包括终止运行的容器：刚运行的一个
docker container ls --all
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES
80b79d2a0257        hello-world         "/hello"            9 minutes ago       Exited (0) 9 minutes ago                       goofy_ptolemy
```

终止容器运行 `docker container kill` 命令

终止运行的容器文件，依然会占据硬盘空间，可以使用 `docker container rm` 命令删除。

```
# 删除刚才的hello world
# docker container rm [containerID]

docker container rm 80b79d2a0257
80b79d2a0257

#删完后，变为空
docker container ls --all
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
```

跑个nginx：
```

# 1.run
docker run -d -p 80:80 --name webserver nginx
Unable to find image 'nginx:latest' locally
latest: Pulling from library/nginx
6ae821421a7d: Pull complete
da4474e5966c: Downloading [========================>                          ]  10.69MB/22.23MB
eb2aec2b9c9f: Download complete

# 2.stop rm
docker stop webserver
docker rm webserver

```


Dockerfile文件
阮一峰
建立koa项目，nodemon跑一次

koa2-learn/learn-docker-koa根目录下，建立dockerfile文件：

```
FROM node:10.15.3
COPY . /app
WORKDIR /app
RUN npm install --registry=https://registry.npm.taobao.org
EXPOSE 3000
```

创建image文件，镜像:根目录下，build

```
$ docker image build -t learn-docker--koa .
Sending build context to Docker daemon  18.94kB
Step 1/5 : FROM node:10.15.3
10.15.3: Pulling from library/node
e79bb959ec00: Downloading [==============================================>    ]  41.76MB/45.34MB
d4b7902036fe: Download complete
1b2a72d4e030: Download complete
d54db43011fd: Downloading [====================================>              ]  36.07MB/50.07MB
69d473365bb3: Downloading [======>                                            ]   28.9MB/215MB
6e2490ee2dc8: Waiting
6381e1b5feaa: Waiting
b1efb42c63e2: Waiting
```

成功后：

```
$ docker image build -t learn-docker--koa .
Sending build context to Docker daemon  18.94kB
Step 1/5 : FROM node:10.15.3
10.15.3: Pulling from library/node
e79bb959ec00: Pull complete
d4b7902036fe: Pull complete
1b2a72d4e030: Pull complete
d54db43011fd: Pull complete
69d473365bb3: Pull complete
6e2490ee2dc8: Pull complete
6381e1b5feaa: Pull complete
b1efb42c63e2: Pull complete
Digest: sha256:dbe1830d4a8b5ec8226b1cb4a760f9e53696130f76bd4c2e5785e13eba19993b
Status: Downloaded newer image for node:10.15.3
 ---> 64c810caf95a
Step 2/5 : COPY . /app
 ---> 093b0dfaa82b
Step 3/5 : WORKDIR /app
 ---> Running in d43af44ecda5
Removing intermediate container d43af44ecda5
 ---> 7d5203421928
Step 4/5 : RUN npm install --registry=https://registry.npm.taobao.org
 ---> Running in 7351397c23f2
npm WARN learn-docker-koa@1.0.0 No repository field.

added 47 packages from 27 contributors and audited 69 packages in 6.59s
found 0 vulnerabilities

Removing intermediate container 7351397c23f2
 ---> 073c57b66e21
Step 5/5 : EXPOSE 3000
 ---> Running in 04195ab55b16
Removing intermediate container 04195ab55b16
 ---> 9d09a0284622
Successfully built 9d09a0284622
Successfully tagged learn-docker--koa:latest
```

查看image：
```
$ docker image ls
REPOSITORY          TAG                 IMAGE ID            CREATED              SIZE
learn-docker--koa   latest              9d09a0284622        About a minute ago   901MB
node                10.15.3             64c810caf95a        3 weeks ago          899MB
nginx               latest              f09fe80eb0e7        2 months ago         109MB
hello-world         latest              fce289e99eb9        3 months ago         1.84kB
```

image:删除，重命名：

```
https://stackoverflow.com/questions/25211198/docker-how-to-change-repository-name-or-rename-image
https://github.com/yeasy/docker_practice/blob/master/image/rm.md
```

生成容器：

```
$ docker container run -p 8000:3000 -it learn-docker-koa /bin/bash
root@94e46d12ccab:/app#
```
这表示你已经在容器里面了，返回的提示符就是容器内部的 Shell 提示符。执行下面的命令,执行普通shell命令

```
$ docker container run -p 8000:3000 -it learn-docker-koa /bin/bash
root@94e46d12ccab:/app# ls
Dockerfile  app.js  node_modules  package-lock.json  package.json
root@94e46d12ccab:/app# node -v
v10.15.3
root@94e46d12ccab:/app# node app.js
starting at port 3000...
```

浏览器打开：http://127.0.0.1:8000/v1/

Ctrl + c 停止 Node 进程，然后按下 Ctrl + d （或者输入 exit）退出容器



跑koa2项目
